2016 Presidential Election Contributions in Ohio by Jamie Brand
========================================================
# Dataset

```{r echo=FALSE, message=FALSE, warning=FALSE, packages}
# Load all of the packages that you end up using
# in your analysis in this code chunk.

# Notice that the parameter "echo" was set to FALSE for this code chunk.
# This prevents the code from displaying in the knitted HTML output.
# You should set echo=FALSE for all code chunks in your file.

library(ggplot2)
library(dplyr)
library(reshape2)
```

```{r echo=FALSE, Load_the_Data}
# Load the Data
setwd("/home/jb/Documents/Data\ Science/udacity_eda_in_r")
ohio <- read.csv("P00000001-OH.csv",row.names = NULL,header = TRUE, na.strings = '"')
# Row names are incorrect due to trailing comma on every line but the headings. 
newnames = colnames(ohio)[2:19]
ohio$election_tp <- NULL
colnames(ohio) <- newnames


```

### Candidate Names (cand_nm)
```{r echo=FALSE,Check_Names}

sort(table(ohio$cand_nm))
# Changing fully capitalized factor to normal capitalization
checkcapitalization <- function(cand_nm){
  if (cand_nm == "CRUZ, RAFAEL EDWARD TED") {
    cand_nm = "Cruz, Rafael Edward 'Ted'"
  }
  return(cand_nm)
}
ohio$cand_nm <- apply(as.matrix(ohio$cand_nm),1,checkcapitalization)
```

There is a duplicate factor here with "CRUZ, RAFAEL EDWARD TED". I changed each instance of it to "Cruz, Rafael Edward 'Ted'" to match the rest of the dataset. 


### Candidate Id, File Number, and FILER ID.  (cand_id,file_nm and cmte_id)
```{r echo=FALSE,Clear_useless_data}
# Drop unneeded collumns
# These columns all contain or vary by the same information - the candidate

# Row names, form_tp and cmte_id all correlate 100% with cand_id so removing
sort(table(ohio$cand_nm))
sort(table(ohio$cand_id))
sort(table(ohio$file_num))
sort(table(ohio$cmte_id))
ohio$cand_id <- NULL
ohio$file_num <- NULL
ohio$cmte_id <- NULL
```

The cand_nm,cand_id,file_nm and cmte_id all collerate 100% so I kept the candidate name (cand_nm) but removed the others. 

### Contributor state (contbr_st)
```{r echo=FALSE,Remove_duplicate_rows}

# Refers to the state. All the values are the same as this is the Ohio dataset
# Removing
table(ohio$contbr_st)
ohio$contbr_st <- NULL
```

No need to keep the contrbr_st features as it refers to the state which is the same throughout this dataset.

### Election type (election_tp)
```{r echo=FALSE}
# 19 Rows of donations for the general election
# Many of these rows have reciept_texts describing a redesignation from other campaings. 
table(ohio$election_tp)
#ohio = ohio[ohio$election_tp == 'P2016',]

```

Values of G2016 Appear to be contributions which have been reassigned (see Receipt_desc feature)


### Reciept description (reciept_desc)
```{r echo=FALSE}
# Reciept_desc Feature

table(ohio$receipt_desc)

```
Details of reattribution or redesignation. 

### Memo code (memo_cd)
```{r echo=FALSE}
# Memo CD feature 
table(ohio$memo_cd)
#ohio[ohio$memo_cd == "X",]
# Only one value fo memo_cd doesn't seem to have any meaning so removing.

```

According to : 
http://www.fec.gov/finance/disclosure/metadata/DataDictionaryContributionsbyIndividuals.shtml
X' indicates that the amount is NOT to be included in the itemization total. 


### Memo text (memo_text)
```{r echo=FALSE}

table(ohio$memo_text)
```

Memo_text feature: Approximately 10% of contributions are earmarked contributions. 

### Transaction id (tran_id)
The transaction id features was removed as it contains no useful information.

```{r echo=FALSE}

ohio$tran_id <- NULL

```

### Receipt Date (contb_receipt_date)
```{r echo=FALSE}

ohio$contb_receipt_dt <- as.Date(ohio$contb_receipt_dt,format="%d-%b-%y")
summary(ohio$contb_receipt_dt)
```

Data needed to be changed from string to date format.

### Postcode (contbr_zip)
```{r echo=FALSE}
getzip <- function(zip){
  zip = substring(zip,1,5)
  return(zip)
}
ohio$contbr_zip <- apply(as.matrix(ohio$contbr_zip),1,getzip)
table(ohio$contbr_zip)
```
The zip codes were reduced to the area zip code (the first 5 characters) as the nine figure numbers have too much detail for this analysis. 

### Form type (form_tp)
```{r echo=FALSE}

table(ohio$form_tp)

```

The form_tp factor levels refer to the following:
SA17A  = Contribution from individuals other than political orgnaisations
SA18 = Transfers from other authorized commitees
SA28A = Refunds to individuals other than political orgnaisations

As shown on this form: 
http://www.fec.gov/finance/disclosure/metadata/DataDictionaryTransactionTypeCodes.shtml


### Additional Candidate Information
```{r echo=FALSE}

cands <- read.csv("candidates.csv",row.names = NULL,header = TRUE, na.strings = '"')
cands

getage <- function(cand_nm){
  age = cands[cands$Name == cand_nm,][1,"Age"]
  return(age)
}
ohio$cand_age <- apply(as.matrix(ohio$cand_nm),1,getage)


getgender <- function(cand_nm){
  gender = cands[cands$Name == cand_nm,][1,"Gender"]
  return(gender)
}
ohio$cand_gender <- apply(as.matrix(ohio$cand_nm),1,getgender)

getparty <- function(cand_nm){
  party = cands[cands$Name == cand_nm,][1,"Party"]
  return(party)
}
ohio$cand_party <- apply(as.matrix(ohio$cand_nm),1,getparty)

getsince <- function(cand_nm){
  since = cands[cands$Name == cand_nm,][1,"Running_Since"]
  return(since)
}
ohio$cand_since <- apply(as.matrix(ohio$cand_nm),1,getsince)

ohio$cand_since <- as.Date(ohio$cand_since,format = "%d-%m-%y")
```

As there are not a huge number of candidates I manually collated extra data about each of them in an csv file. These were added as features in the main dataset.

### Predicted Contributor Gender (contbr_gender)
A predicted gender of contributor feature was created based on the contributors first name. 

It was made with a free csv file of first names with genders. 
http://tedwise.com/2011/02/08/check-the-gender-of-a-first-name

This method could not predict every gen+
        coord_cartesian(ylim=c(0, 1000))der so there a number of N/A values. While the genders that are predictied may not be 100% correct they should be good enough to look for trends in the data. 
```{r echo=FALSE}
names <- read.csv("names.csv",row.names = NULL,header = FALSE, na.strings = '"')

getcont_gender <- function(cont_nm){
  cont_nm = strsplit(cont_nm,",")[[1]][2]
  cont_nm = strsplit(cont_nm," ")[[1]][2]
  gender = names[names$V1 == cont_nm,][1,2]
  return(gender)
}

ohio$contbr_gender <-  apply(as.matrix(ohio$contbr_nm),1,getcont_gender)


table(ohio$contbr_gender)
```
###Summary of dataset

```{r echo=FALSE}
summary(ohio)

dim(ohio)
```

# Univariate Plots Section
### Distribution of contribution amounts

```{r echo=FALSE, Univariate_Plots}
ggplot(ohio,aes(contb_receipt_amt)) +
         geom_histogram() 
```

We can see there are a number of outliers on either side of the distribution. The negative values are from refunds / redesignation of donations. 
We can focus on the area between 0 and 1500 dollars for more detail

```{r echo=FALSE}
ggplot(ohio,aes(contb_receipt_amt)) +
         geom_histogram() +
         scale_x_continuous(limits = c(0,1500))
  
```

And on contributions between 0 and 500 dollars

```{r echo=FALSE}
ggplot(ohio,aes(contb_receipt_amt)) +
         geom_histogram(binwidth =10) +
         scale_x_continuous(limits = c(0,500))
```

Here we see an interesting tendency that people have to donate in 'round' numbers, with peaks at $50 dollar intervals. 


### When were the contributions made? 
It is still near the beginning of the campaigns so we can see that the number of contributions began to rise in April 2015. I expect the number of donations will continue to rise as the campaigns continue. 

```{r echo=FALSE}
ggplot(ohio,aes(contb_receipt_dt)) +
         geom_histogram(binwidth=2) 
```


### Contributions by candidate
```{r echo=FALSE}
ggplot(ohio,aes(cand_nm)) +
         geom_bar() + theme(axis.text.x=element_text(angle=90, hjust=1))
 
        
```


I am aware that a potential problem of this dataset is its incompleteness. It is early in the campaign and some candidates announced that they were running much earlier. Some candidates have had a month more than others to accept contributions. 
To account for this we can look at the average number of contributions per day for each candidate. 

```{r echo=FALSE}

ohio$runningdays <- (max(ohio$contb_receipt_dt)) - ohio$cand_since  
ohio$runningdays <- as.numeric(ohio$runningdays, unit = "days")

contsbyday <- ohio %>% 
    group_by(cand_nm) %>%
    summarise(total = length(cand_nm),mean(runningdays))

contsbyday$ave = contsbyday$total/contsbyday$`mean(runningdays)`


ggplot(contsbyday,aes(x=cand_nm,y=ave)) + 
         geom_bar(stat="identity") + theme(axis.text.x=element_text(angle=90, hjust=1))
```

This plot is visually similar to the total number of contributions made by candidate. While obviously we should be aware of the different starting dates for the candidates, this plot implies that it does not have a strong effect on the number of contributions made. I suspect a reason for this may be that were aware that candidates were going to announce they were running before the announcements came.   


### Candidates by Political party


```{r echo=FALSE}
ggplot(cands,aes(Party)) +
         geom_bar() 
```


### Contibutions by Political party
```{r echo=FALSE}
ggplot(ohio,aes(cand_party)) +
         geom_bar() 
```
### Candidates by Age
```{r echo=FALSE}
ggplot(cands,aes(Age)) +
         geom_histogram(binwidth = 10) 
```

This gives us a nice idea of the distribution of ages.

### Contibutions by Age of candidate
```{r echo=FALSE}
ggplot(ohio,aes(cand_age)) +
         geom_histogram(binwidth = 10) 
```

This seems to show a very unusual relation ship between the age of the candidate and the number of contributions made. However, it is likely to be a result of only a relatively small number of candidates with a wide range of support. 
We can change the binsize to see if the relationship still appears.

```{r echo=FALSE}
ggplot(ohio,aes(cand_age)) +
         geom_histogram(binwidth = 5) 
```

In the second plot there is still an unusual distribution so perhaps this is something we can look at later. 


### Contributions by city

```{r echo=FALSE}
ggplot(ohio,aes(contbr_city)) +
         geom_histogram() 
```

This is difficult to read. Repeat with only the top twenty five cities.
```{r echo=FALSE}
  
topcities = sort(table(ohio$contbr_city),decreasing = TRUE)[1:25]

tc = as.data.frame(as.matrix(topcities))
tc$names <- rownames(tc) 
colnames(tc) <- c("Number_of_Contributions","City")
ggplot(tc,aes(x = City,y = Number_of_Contributions)) +
         geom_bar(stat = "identity") + theme(axis.text.x=element_text(angle=90, hjust=1))
```

### Contributions by occupation

We know there are a lot of occupations so lets limit it to the top 25. 

```{r echo=FALSE}
  
topocc = sort(table(ohio$contbr_occupation),decreasing = TRUE)[1:25]
print(topocc)
```

Lets remove the 'Information Requested' factors as they tell us nothing. 

```{r echo=FALSE}
occs = ohio[ohio$contbr_occupation != "INFORMATION REQUESTED",]
occs = occs[occs$contbr_occupation != "",]
occs = occs[occs$contbr_occupation != "INFORMATION REQUESTED PER BEST EFFORTS",]

topocc = sort(table(occs$contbr_occupation),decreasing = TRUE)[1:25]

to = as.data.frame(as.matrix(topocc))
to$names <- rownames(to) 
colnames(to) <- c("Number_of_Contributions","Occupation")
ggplot(to,aes(x = Occupation,y = Number_of_Contributions)) +
         geom_bar(stat = "identity")  + theme(axis.text.x=element_text(angle=90, hjust=1))


```
### Contributions by employer

We know there are a lot of employes so lets limit it to the top 25. 
Also, since we are specifically interested in which company's employees make the most contributions, we can remove factors of 'Retired', 'Self','None','N/A' and 'Self-employed'.

```{r echo=FALSE}


occs = ohio[ohio$contbr_employer != "SELF",]
occs = occs[occs$contbr_employer != "RETIRED",]
occs = occs[occs$contbr_employer != "N/A",]
occs = occs[occs$contbr_employer != "NONE",]
occs = occs[occs$contbr_employer != "SELF-EMPLOYED",]
occs = occs[occs$contbr_employer != "SELF EMPLOYED",]
occs = occs[occs$contbr_employer != "NOT EMPLOYED",]
occs = occs[occs$contbr_employer != "HOMEMAKER",]
occs = occs[occs$contbr_employer != "INFORMATION REQUESTED PER BEST EFFORTS",]
occs = occs[occs$contbr_employer != "INFORMATION REQUESTED",]
occs = occs[occs$contbr_employer != "",]
topocc = sort(table(occs$contbr_employer),decreasing = TRUE)[1:25]

to = as.data.frame(as.matrix(topocc))
to$names <- rownames(to) 
colnames(to) <- c("Number_of_Contributions","Employer")
ggplot(to,aes(x = Employer,y = Number_of_Contributions)) +
  geom_bar(stat = "identity")  + theme(axis.text.x=element_text(angle=90, hjust=1))


```

### Multiple Contributions 

Does anyone contribute ore than once? Who are the top contributors

```{r echo=FALSE}
topcons = sort(table(ohio$contbr_nm),decreasing = TRUE)

tc = as.data.frame(as.matrix(topcons))
tc$names <- rownames(tc) 
colnames(tc) <- c("Number_of_Contributions","Contributor")
ggplot(tc,aes(Number_of_Contributions)) +
         geom_histogram()  












topcons = sort(table(ohio$contbr_nm),decreasing = TRUE)[1:8]




tc = as.data.frame(as.matrix(topcons))
tc$names <- rownames(tc) 
colnames(tc) <- c("Number_of_Contributions","Contributor")
ggplot(tc,aes(x = Contributor,y = Number_of_Contributions)) +
         geom_bar(stat = "identity") + theme(axis.text.x=element_text(angle=90, hjust=1))


```

We can see that, while most people have only made one contribution a number have made multiple contributions. 

# Univariate Analysis

### What is the structure of your dataset?
There are records for 2452 contributions made. Each contribution has 17 features. 
The features contain information about the contributions itself - the amount and the date when the contribution was made. 
The features also have information about to which candidate the contribution was made. These include the candidates name, age, gender and political party as well as when the candidate announced that they are running. 
There are also features which tell us about the contributors including their name, postcode/city and their occupation and employer. We also have a feature with a predicted gender for the contributor. 

### What is/are the main feature(s) of interest in your dataset?
The features of interest are the candidate names and their political parties. I hope to look at who is voting for which candidate / party and find any patterns in 'how' they vote. For instance, do contributors to one party make higher or lower contributions than contributors to the other. 


### What other features in the dataset do you think will help support your investigation into your feature(s) of interest?
I will be interested to see how the candidate chosen varies with the occupation and employer of the contributor. 
I expect different candidates may be more or less popular depending on the area the contributor is for at a city or postcode level. 


### Did you create any new variables from existing variables in the dataset?
I was worried that the date the candidates announced their campaign could have had an effect on the number of contributions they had. To check this I compared a bar plot of the number of contributions each candidate had with a bar plot of the average number of contributions per day for each candidate. 
I manually create a csv file with details of each candidate which was used to create the candidate age, party and gender. 
I also created a predicted gender feature for the contributors. While this is cannot be expected to be completely accurate, and has produced missing values, it will by useful for looking for differences in the way different genders contribute. 


### Of the features you investigated, were there any unusual distributions? Did you perform any operations on the data to tidy, adjust, or change the form of the data? If so, why did you do this?
The distribution of contribution amounts showed a left skewed distribution. On lowering the bin size however, it became apparent that there were peaks at $0-$10, $20-$30,$50-$60,$100-$110, and approximately every fifty dollars onwards. I think this suggests people like to contribute in 'round' numbers (i.e. $10,$25,$50,$100 etc)
For a number of factorial features, there were too many factors to be plotted well, for these I sorted and chose the most common factors to plot. With the occupation and employer features I also removed some results which were not relevent, for instance 'Information Requested' was a common factor in the occupation feature but is clearly not an occupation. Similarly, while 'Self' can be an employer, we are interested in company names for the 'employer' feature so these responses were removed (two people working for 'self' do not have the same employer!)



# Bivariate Plots Section

### Contribution amount by candidate

Who has recieved the highest total of contributions so far?

```{r echo=FALSE}

topcands <- group_by(ohio,cand_nm)
topcands <- summarize(topcands,sum(contb_receipt_amt))

colnames(topcands) <- c("Candidate","Total_Amount")
ggplot(topcands,aes(x=Candidate,y=Total_Amount)) +
  geom_bar(stat="identity") +
  coord_flip()



```








Which candidates are getting the largest donations? 

```{r echo=FALSE}
ggplot(ohio,aes(x=cand_nm,y=contb_receipt_amt)) +
   geom_jitter(stat = "identity",alpha = 0.5, position = position_jitter(width = .1)) +
  coord_cartesian(ylim=c(0, 6000))
```




Does the distribution of the contribution amount vary by candidate?

```{r echo=FALSE, Bivariate_Plots}

ggplot(ohio,aes(x = cand_nm,y = contb_receipt_amt)) +
        geom_boxplot() +
        coord_flip() +
        expand_limits(y = c(-4000,6000)) 


```







Obviously there is a lot of variation there. I want to know what is causing this. I wonder if the number of contributions effects the distributions. The cand_since feature may also be of interest here. First though, I want to look at the distributions by party.

### Contribution amount by party
```{r echo=FALSE}
ggplot(ohio,aes(x = cand_party,y = contb_receipt_amt)) +
        geom_boxplot() +
        expand_limits(y = c(-4000,6000))
```

Let's look at that again without so many outliers

```{r echo=FALSE}
ggplot(ohio,aes(x = cand_party,y = contb_receipt_amt)) +
        geom_boxplot() +
        coord_cartesian(ylim=c(0, 1000))
```

There does seem to be a noticable difference in the distribution of Democratic and Republican contributions here. There is only one independent candidate so we should take care comparing that distribution to the others. 

Let's have a look at the same data in a different plot. 

```{r echo=FALSE}
ggplot(ohio,aes(x = contb_receipt_amt)) +
        geom_histogram(binwidth=200) +
        coord_cartesian(xlim=c(0, 3000)) +
        facet_wrap (~ cand_party)



```

From this plot it seems that there is as much difference in the distributions as first thought. The difference in the box plot could be due to the much higher number of contributions made to the Rupublican party overall. 

Let's try a third way of looking at this. 

```{r echo = FALSE}
amounts = ohio[ohio$contb_receipt_amt > 0,]


quans <- quantile(amounts$contb_receipt_amt,c(.2,.4,.6,.8,1))

getquans <- function(amt){
  quant = NA
  if (amt <= quans[1]) {
    quant = paste0("0%($0) to 20%($",quans[1],")")
  } 
  else if (amt > quans[1] && amt <= quans[2]) {
    quant = paste0("20%($",quans[1],") to 40%($",quans[2],")")
  } 
  else if (amt > quans[2] && amt <= quans[3]) {
    quant = paste0("40%($",quans[2],") to 60%($",quans[3],")")
  } 
  else if (amt > quans[3] && amt <= quans[4]) {
    quant = paste0("60%($",quans[3],") to 80%($",quans[4],")")
  } 
  else {
    quant = paste0("80%($",quans[4],") to 100%($",quans[5],")")
  } 
  
  return(quant)
}
ohio$amtquan <- apply(as.matrix(ohio$contb_receipt_amt),1,getquans)


ggplot(ohio,aes(x = cand_party,fill = cand_party))+
  geom_bar() + 
  facet_wrap (~ amtquan)

```

Once again, we are finding a difference in the distribution. This time much more pronounced. The rupublican party is getting more donations in the center of the distribution while the democratic party are getting less contributions in the center but more at the top and bottom 20% of contribution amount. 

### Contribution amount by time

```{r echo=FALSE}

ggplot(ohio[order(ohio$contb_receipt_dt),],aes(x = contb_receipt_dt, y= cumsum(contb_receipt_amt))) +
         geom_line()
        




```





### How Occupations contribute by Party

Here are the 25 most common occupations in our dataset, the number of total contributions each occupation has made and which party the contributions were for. 

```{r echo=FALSE}

# Remove unnessesary occupations
occs = ohio[ohio$contbr_occupation != "INFORMATION REQUESTED",]
occs = occs[occs$contbr_occupation != "",]
occs = occs[occs$contbr_occupation != "INFORMATION REQUESTED PER BEST EFFORTS",]


#get df with top 25 occupations
topocc = sort(table(occs$contbr_occupation),decreasing = TRUE)[1:25]
occs = ohio[ohio$contbr_occupation %in% rownames(topocc),]
## group by occupation and party
occbyparty <- occs %>% 
    group_by(contbr_occupation,cand_party) %>% summarise(num=length(contbr_occupation))

## changed to wide format
occs <- dcast(occbyparty, contbr_occupation + num ~ cand_party,value.var="num")

## group by contbr occupation again (there must be a better way of doing this)
occbyparty <- occs %>% 
    group_by(contbr_occupation) %>%   
    summarise(dem=sum(Democratic,na.rm=TRUE),ind = sum(Independent,na.rm=TRUE),rep=sum(Republican,na.rm=TRUE))

# as.data.frame needed to print every row in html
as.data.frame(occbyparty)


```

Here is a chart showing the percentage of each occupations contributions to each party. 

```{r echo=FALSE}
# add total and percentages to each column.
occbyparty$total <- occbyparty$dem + occbyparty$ind + occbyparty$rep


occbyparty$dem <- (occbyparty$dem/occbyparty$total)*100

occbyparty$ind <- (occbyparty$ind/occbyparty$total)*100

occbyparty$rep <- (occbyparty$rep/occbyparty$total)*100

occbyparty$total <- NULL

occ <- melt(occbyparty, id.vars = "contbr_occupation")

ggplot(occ,aes(x = contbr_occupation,y=value,fill=variable))+
  geom_bar(stat="identity") +
  coord_flip()
```

### How Employers vary by contributions to each Party

```{r echo=FALSE}

occs = ohio[ohio$contbr_employer != "SELF",]
occs = occs[occs$contbr_employer != "RETIRED",]
occs = occs[occs$contbr_employer != "N/A",]
occs = occs[occs$contbr_employer != "NONE",]
occs = occs[occs$contbr_employer != "SELF-EMPLOYED",]
occs = occs[occs$contbr_employer != "SELF EMPLOYED",]
occs = occs[occs$contbr_employer != "NOT EMPLOYED",]
occs = occs[occs$contbr_employer != "HOMEMAKER",]
occs = occs[occs$contbr_employer != "INFORMATION REQUESTED PER BEST EFFORTS",]
occs = occs[occs$contbr_employer != "INFORMATION REQUESTED",]
occs = occs[occs$contbr_employer != "",]
#get df with top 25 occupations
topocc = sort(table(occs$contbr_employer),decreasing = TRUE)[1:25]

occs = ohio[ohio$contbr_employer %in% rownames(topocc),]
## group by employer and party
occbyparty <- occs %>% 
    group_by(contbr_employer,cand_party) %>% summarise(num=length(contbr_employer))

## changed to wide format
occs <- dcast(occbyparty, contbr_employer + num ~ cand_party,value.var="num")

## group by contbr employer again (there must be a better way of doing this)
occbyparty <- occs %>% 
    group_by(contbr_employer) %>%   
    summarise(dem=sum(Democratic,na.rm=TRUE),ind = sum(Independent,na.rm=TRUE),rep=sum(Republican,na.rm=TRUE))

# as.data.frame needed to print every row in html
as.data.frame(occbyparty)


```

Here is a chart showing the percentage of contributions to each party from employees of the twenty five most common employees. 

```{r echo=FALSE}
# add total and percentages to each column.
occbyparty$total <- occbyparty$dem + occbyparty$ind + occbyparty$rep


occbyparty$dem <- (occbyparty$dem/occbyparty$total)*100

occbyparty$ind <- (occbyparty$ind/occbyparty$total)*100

occbyparty$rep <- (occbyparty$rep/occbyparty$total)*100

occbyparty$total <- NULL

occ <- melt(occbyparty, id.vars = "contbr_employer")

ggplot(occ,aes(x = contbr_employer,y=value,fill=variable))+
  geom_bar(stat="identity") +
  coord_flip()
```



### Contributions to each party by city. 

Here is a the same chart, this time showing the percentage of contributions to each party from the most common cities in the dataset. 

```{r echo=FALSE}

#get df with top 25 occupations
topc = sort(table(ohio$contbr_city),decreasing = TRUE)[1:25]

cities = ohio[ohio$contbr_city %in% rownames(topc),]

gender <- ohio[!is.na(ohio$contbr_gender),] %>% 
  group_by(contbr_gender,cand_gender) %>% 
  summarise(count=n()) %>% 
  mutate(perc=count/sum(count))



## group by employer and party
citiesbyparty <- cities %>% 
    group_by(contbr_city,cand_party) %>% summarise(num=length(contbr_city))

## changed to wide format
cities <- dcast(citiesbyparty, contbr_city + num ~ cand_party,value.var="num")

## group by contbr employer again (there must be a better way of doing this)
citiesbyparty <- cities %>% 
    group_by(contbr_city) %>%   
    summarise(dem=sum(Democratic,na.rm=TRUE),ind = sum(Independent,na.rm=TRUE),rep=sum(Republican,na.rm=TRUE))

# add total and percentages to each column.
citiesbyparty$total <- citiesbyparty$dem + citiesbyparty$ind + citiesbyparty$rep


citiesbyparty$dem <- (citiesbyparty$dem/citiesbyparty$total)*100

citiesbyparty$ind <- (citiesbyparty$ind/citiesbyparty$total)*100

citiesbyparty$rep <- (citiesbyparty$rep/citiesbyparty$total)*100

citiesbyparty$total <- NULL

cities <- melt(citiesbyparty, id.vars = "contbr_city")

ggplot(cities,aes(x = contbr_city,y=value,fill=variable))+
  geom_bar(stat="identity") +
  coord_flip()

```

### Contributions by gender. 
Do genders contribute differently? 

```{r echo=FALSE}


ggplot(ohio[!is.na(ohio$contbr_gender),],aes(contbr_gender, fill=cand_party)) +
  geom_bar()


```
It definitely seems like women are voting more (proportianatly) for democratic candidates and less for republican candidates than men. There may be another factor at work here though. First let's look at the same data as percentages to make it easier to compare. 

```{r echo=FALSE}
gender <- ohio[!is.na(ohio$contbr_gender),] %>% 
  group_by(contbr_gender,cand_party) %>% 
  summarise(count=n()) %>% 
  mutate(perc=count/sum(count))



ggplot(gender,aes(contbr_gender, y=perc*100, fill=cand_party)) +
  geom_bar(stat="identity")

```


Now, the current most popular Democratic party candidate is a woman. It is possible that the female contributors are more likely to contribute to a female candidate? 


```{r echo=FALSE}

gender <- ohio[!is.na(ohio$contbr_gender),] %>% 
  group_by(contbr_gender,cand_gender) %>% 
  summarise(count=n()) %>% 
  mutate(perc=count/sum(count))



ggplot(gender,aes(contbr_gender, y=perc*100, fill=cand_gender)) +
  geom_bar(stat="identity")
```

It certainly seems possible that female contributors are more likely to vote for female candidates but it is impossible to test. We cannot be sure if female contributors are contributing for the democratic candidate because she is female or they are contributing for the female candidate because she is democratic. 

I would like to mention that I am looking at the effect of female candidates simply because they are less common than male candidates. It would be equally valid to suggest that men are more likely to contribute to male candidates (and equally inconclusive).



Let's look at which how many contributions each candidate recieved from each gender. 
```{r echo = FALSE}

gender <- ohio[!is.na(ohio$contbr_gender),] %>% 
  group_by(contbr_gender,cand_nm) %>% 
  summarise(count=n())


ggplot(gender,aes(x=cand_nm, y= count, fill = contbr_gender)) +
  geom_bar(stat="identity")+
  coord_flip()

```

That will be easier to compare if we use percentages. 
```{r echo = FALSE}

gender <- ohio[!is.na(ohio$contbr_gender),] %>% 
  group_by(contbr_gender,cand_nm) %>% 
  summarise(count=n()) 

totals <- table(ohio[!is.na(ohio$contbr_gender),]$cand_nm)


gettotal <- function(cand_nm){
  total = as.numeric(totals[cand_nm])
  return(total)
}
gender$total <- apply(as.matrix(gender$cand_nm),1,gettotal)




ggplot(gender,aes(x=cand_nm, y= (count/total)*100, fill = contbr_gender)) +
  geom_bar(stat="identity")+
  coord_flip()

```

While it certainly looks like some candidates are radically preferred by a specific gender, it is important to remember that some candidates have a very low number of contributions so in fact the first plot is actually more usefull. 


### Looking a bit more at the amount of the contributions

What is the mean contribution amount by occupation?

```{r echo=FALSE}
occs = ohio[ohio$contbr_occupation != "INFORMATION REQUESTED",]
occs = occs[occs$contbr_occupation != "",]
occs = occs[occs$contbr_occupation != "INFORMATION REQUESTED PER BEST EFFORTS",]
topocc = sort(table(occs$contbr_occupation),decreasing = TRUE)[1:25]
meancontrib = ohio[ohio$contbr_occupation %in% rownames(topocc),] %>% 
    group_by(contbr_occupation) %>%   
    summarise(mean_contrib = mean(contb_receipt_amt))

ggplot(meancontrib,aes(x = contbr_occupation, y = mean_contrib)) +
  geom_bar(stat="identity") +
  coord_flip()
```

This is surprisingly close to what I'd expect with the occupations I'd imagine being better paid making larger contributions. 

Let's look at the mean amount by city. 
```{r echo=FALSE}

topcities = sort(table(ohio$contbr_city),decreasing = TRUE)[1:25]

cities = ohio[ohio$contbr_city %in% rownames(topcities),] %>%     group_by(contbr_city) %>%   
    summarise(mean_contrib = mean(contb_receipt_amt))

ggplot(cities,aes(x = contbr_city, y = mean_contrib)) +
  geom_bar(stat="identity") +
  coord_flip()
```

Shaker Heights looks like a nice place to live. It would be interesting to look at how affluent each city is (perhaps looking at mean property prices) but that is beyond the scope of this project. 

I suspect that looking at the mean amount donated by gender won't reveal much, but let's look at it anyway. 


```{r echo=FALSE}
gender = ohio[!is.na(ohio$contbr_gender),] %>%    
    group_by(contbr_gender) %>%   
    summarise(mean_contrib = mean(contb_receipt_amt))

ggplot(gender,aes(x = contbr_gender, y = mean_contrib)) +
  geom_bar(stat="identity")

```






# Bivariate Analysis

### Talk about some of the relationships you observed in this part of the investigation. How did the feature(s) of interest vary with other features in the dataset?



### Did you observe any interesting relationships between the other features (not the main feature(s) of interest)?

### What was the strongest relationship you found?




# Multivariate Plots Section
### candidate, amount, party. 
```{r echo=FALSE, Multivariate_Plots}
ggplot(ohio,aes(x=cand_nm,y=contb_receipt_amt)) +
   geom_jitter(aes(color=cand_party),stat = "identity",alpha = 0.25, position = position_jitter(width = .3)) +
  scale_y_continuous(limits=c(0, 6000))+
coord_flip()
```

###candidate, amount, gender

```{r echo=FALSE}
ggplot(ohio[!is.na(ohio$contbr_gender),],aes(x=cand_nm,y=contb_receipt_amt)) +
   geom_jitter(aes(color=contbr_gender),stat = "identity",alpha = 0.25, position = position_jitter(width = .3))+
  scale_y_continuous(limits=c(0, 3000))+
coord_flip()

```

###total amt / party / time
```{r echo=FALSE}

ohio = ohio[order(ohio$contb_receipt_dt),]
ohio$party_cumulative <-ave(ohio$contb_receipt_amt,ohio$cand_party,FUN=cumsum) 

ggplot(ohio[order(ohio$contb_receipt_dt),],aes(x = contb_receipt_dt, y= party_cumulative,color = cand_party)) +
         geom_line()

```



###total amt / cand / time


```{r echo=FALSE}
ohio = ohio[order(ohio$contb_receipt_dt),]
ohio$cand_cumulative <-ave(ohio$contb_receipt_amt,ohio$cand_nm,FUN=cumsum) 

ggplot(ohio[order(ohio$contb_receipt_dt),],aes(x = contb_receipt_dt, y= cand_cumulative,color = cand_nm)) +
         geom_line()

```


```{r echo=FALSE}


ggplot(ohio[order(ohio$contb_receipt_dt),],aes(x = contb_receipt_dt, y= cand_cumulative,color = cand_nm)) +
         geom_line() +
scale_x_date(limits = as.Date(c('2015-03-01','2015-07-01')))


                                 
```



###total amt / cand / runningdays

```{r echo = FALSE}

ohio$runingDaysAtCont <- as.numeric(ohio$contb_receipt_dt - ohio$cand_since)

ggplot(ohio[order(ohio$runingDaysAtCont),],aes(x = runingDaysAtCont, y= cand_cumulative,color = cand_nm)) +
         geom_line()

```




###city / party / amt
```{r echo=FALSE}
getTopN <- function (feature,n) {
  return (sort(table(feature),decreasing = TRUE)[1:n])
}

topcities = getTopN(ohio$contbr_city,25)
cities = ohio[ohio$contbr_city %in% rownames(topcities),]


## group by occupation and party
citiesbyparty <- cities %>% 
    group_by(contbr_city,cand_party) %>% summarise(num=sum(contb_receipt_amt))


## changed to wide format
cities <- dcast(citiesbyparty, contbr_city + num ~ cand_party,value.var="num")

## group by contbr occupation again (there must be a better way of doing this)
cities <- cities %>% 
    group_by(contbr_city) %>%   
    summarise(dem=sum(Democratic,na.rm=TRUE),ind = sum(Independent,na.rm=TRUE),rep=sum(Republican,na.rm=TRUE))



cities <- melt(cities, id.vars = "contbr_city")



ggplot(cities,aes(x = contbr_city,y=value,fill=variable))+
  geom_bar(stat="identity") +
  coord_flip()+ 
 scale_fill_manual(values=c("blue", "white", "red"))


```







###occ / party / amt
```{r echo = FALSE}

# Remove unnessesary occupations
occs = ohio[ohio$contbr_occupation != "INFORMATION REQUESTED",]
occs = occs[occs$contbr_occupation != "",]
occs = occs[occs$contbr_occupation != "INFORMATION REQUESTED PER BEST EFFORTS",]


#get df with top 25 occupations
topocc = sort(table(occs$contbr_occupation),decreasing = TRUE)[1:25]
occs = ohio[ohio$contbr_occupation %in% rownames(topocc),]
## group by occupation and party
occbyparty <- occs %>% 
    group_by(contbr_occupation,cand_party) %>% summarise(num = sum(contb_receipt_amt))

## changed to wide format
occs <- dcast(occbyparty, contbr_occupation + num ~ cand_party,value.var = "num")

## group by contbr occupation again (there must be a better way of doing this)
occbyparty <- occs %>% 
    group_by(contbr_occupation) %>%   
    summarise(dem = sum(Democratic,na.rm = TRUE),ind = sum(Independent,na.rm = TRUE),rep = sum(Republican,na.rm = TRUE))



# add total and percentages to each column.


occ <- melt(occbyparty, id.vars = "contbr_occupation")



ggplot(occ,aes(x = contbr_occupation,y = value,fill = variable))+
  geom_bar(stat = "identity") +
  coord_flip() + 
 scale_fill_manual(values = c("blue", "white", "red"))

```



###Distribution of amount by candidate and party


```{r}
ggplot(ohio,aes(x = cand_nm,y = contb_receipt_amt,fill=cand_party)) +
        geom_boxplot() +
        coord_flip(ylim=c(0, 3000)) 
```









# Multivariate Analysis

### Talk about some of the relationships you observed in this part of the investigation. Were there features that strengthened each other in terms of looking at your feature(s) of interest?

### Were there any interesting or surprising interactions between features?

### OPTIONAL: Did you create any models with your dataset? Discuss the strengths and limitations of your model.

------

# Final Plots and Summary

### Plot One
```{r echo=FALSE, Plot_One}
# Remove unnessesary occupations
occs = ohio[ohio$contbr_occupation != "INFORMATION REQUESTED",]
occs = occs[occs$contbr_occupation != "",]
occs = occs[occs$contbr_occupation != "INFORMATION REQUESTED PER BEST EFFORTS",]


#get df with top 25 occupations
topocc = sort(table(occs$contbr_occupation),decreasing = TRUE)[1:25]
occs = ohio[ohio$contbr_occupation %in% rownames(topocc),]
## group by occupation and party
occbyparty <- occs %>% 
    group_by(contbr_occupation,cand_party) %>% summarise(num=length(contbr_occupation))

## changed to wide format
occs <- dcast(occbyparty, contbr_occupation + num ~ cand_party,value.var="num")

## group by contbr occupation again (there must be a better way of doing this)
occbyparty <- occs %>% 
    group_by(contbr_occupation) %>%   
    summarise(dem=sum(Democratic,na.rm=TRUE),ind = sum(Independent,na.rm=TRUE),rep=sum(Republican,na.rm=TRUE))



# add total and percentages to each column.
occbyparty$total <- occbyparty$dem + occbyparty$ind + occbyparty$rep


occbyparty$dem <- (occbyparty$dem/occbyparty$total)*100

occbyparty$ind <- (occbyparty$ind/occbyparty$total)*100

occbyparty$rep <- (occbyparty$rep/occbyparty$total)*100

occbyparty$total <- NULL

occ <- melt(occbyparty, id.vars = "contbr_occupation")



ggplot(occ,aes(x = contbr_occupation,y=value,fill=variable))+
  geom_bar(stat="identity") +
  coord_flip()+ 
 scale_fill_manual(values=c("blue", "white", "red"))

```

### Description One


### Plot Two
```{r echo=FALSE, Plot_Two}

```

### Description Two


### Plot Three
```{r echo=FALSE, Plot_Three}

```

### Description Three

------

# Reflection
